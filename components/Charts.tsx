

import React, { useState } from 'react';
import {
  AreaChart,
  Area,
  XAxis,
  YAxis,
  CartesianGrid,
  Tooltip,
  ResponsiveContainer,
  Legend,
  LineChart,
  Line,
  BarChart,
  Bar,
  ReferenceLine,
  PieChart,
  Pie,
  Cell,
  LabelList,
  ComposedChart,
  Treemap
} from 'recharts';
import { PPKDataRow, CryptoDataRow, AnyDataRow } from '../types';

interface ChartProps {
  data: AnyDataRow[];
  className?: string; // Added className prop for flexibility
}

const formatCurrency = (value: number | undefined) => `${(value || 0).toLocaleString('pl-PL', { maximumFractionDigits: 0 })} zł`;
const formatDate = (dateStr: string) => {
  if (!dateStr) return '';
  const date = new Date(dateStr);
  return date.toLocaleDateString('pl-PL', { month: 'short', year: '2-digit' });
};

// --- OMF Specific Charts ---

interface OMFAllocationProps {
  data: { name: string; value: number; color?: string }[];
  title?: string;
}

const COLORS = ['#0ea5e9', '#8b5cf6', '#10b981', '#f59e0b', '#f43f5e', '#64748b'];
const EXTENDED_COLORS = [
  '#0ea5e9', '#8b5cf6', '#10b981', '#f59e0b', '#f43f5e', '#64748b',
  '#06b6d4', '#ec4899', '#84cc16', '#eab308', '#d946ef', '#6366f1',
  '#14b8a6', '#f97316', '#a855f7', '#ef4444', '#22c55e', '#3b82f6'
];

export const OMFAllocationChart: React.FC<OMFAllocationProps> = ({ data, title }) => {
  return (
    <div className="h-80 w-full flex flex-col items-center">
      {title && <h4 className="text-sm font-semibold text-slate-500 mb-2">{title}</h4>}
      <ResponsiveContainer width="100%" height="100%">
        <PieChart>
          <Pie
            data={data}
            cx="50%"
            cy="50%"
            innerRadius={60}
            outerRadius={100}
            paddingAngle={2}
            dataKey="value"
          >
            {data.map((entry, index) => (
              <Cell key={`cell-${index}`} fill={entry.color || COLORS[index % COLORS.length]} strokeWidth={1} stroke="#fff" />
            ))}
          </Pie>
          <Tooltip 
            formatter={(value: number) => [`${(value || 0).toLocaleString('pl-PL')} zł`, 'Wartość']}
            contentStyle={{ backgroundColor: '#fff', borderRadius: '8px', border: '1px solid #e2e8f0' }}
          />
          <Legend verticalAlign="bottom" iconType="circle" />
        </PieChart>
      </ResponsiveContainer>
    </div>
  );
};

export const OMFStructureChart: React.FC<OMFAllocationProps> = ({ data }) => {
  return (
    <div className="h-[500px] w-full flex flex-col items-center">
      <ResponsiveContainer width="100%" height="100%">
        <PieChart>
          <Pie
            data={data}
            cx="50%"
            cy="50%"
            innerRadius={80}
            outerRadius={160}
            paddingAngle={1}
            dataKey="value"
          >
            {data.map((entry, index) => (
              <Cell key={`cell-${index}`} fill={entry.color || EXTENDED_COLORS[index % EXTENDED_COLORS.length]} strokeWidth={1} stroke="#fff" />
            ))}
          </Pie>
          <Tooltip 
            formatter={(value: number) => [`${(value || 0).toLocaleString('pl-PL')} zł`, 'Wartość']}
            contentStyle={{ backgroundColor: '#fff', borderRadius: '8px', border: '1px solid #e2e8f0' }}
          />
          <Legend 
            layout="vertical" 
            verticalAlign="middle" 
            align="right"
            iconType="circle" 
            wrapperStyle={{ fontSize: '12px', maxHeight: '480px', overflowY: 'auto' }}
            formatter={(value, entry: any) => {
                const val = entry.payload.value;
                return <span className="text-slate-600 font-medium ml-1">{value} <span className="text-slate-400 text-xs ml-1">({val.toLocaleString('pl-PL')} zł)</span></span>;
            }}
          />
        </PieChart>
      </ResponsiveContainer>
    </div>
  );
};

// Helper to determine color based on ROI
const getRoiColor = (roi: number) => {
  if (roi === undefined || roi === null || isNaN(roi)) return '#64748b'; // Slate 500 (Neutral)

  if (roi > 0) {
    if (roi >= 50) return '#047857'; // Emerald 700
    if (roi >= 20) return '#059669'; // Emerald 600
    if (roi >= 10) return '#10b981'; // Emerald 500
    return '#34d399'; // Emerald 400
  } else if (roi < 0) {
    if (roi <= -50) return '#b91c1c'; // Red 700
    if (roi <= -20) return '#dc2626'; // Red 600
    if (roi <= -10) return '#ef4444'; // Red 500
    return '#f87171'; // Red 400
  }
  
  return '#64748b'; // Zero ROI
};

// INLINE SVG DICTIONARY
// Used to reliably render logos without depending on external file loading which can fail in preview envs
const ASSET_LOGOS: Record<string, { viewBox: string, content: React.ReactNode }> = {
  PPK: {
    viewBox: "0 0 100 100",
    content: (
      <>
        <rect width="100" height="100" fill="black" />
        <text x="50" y="50" fontFamily="Arial" fontSize="30" fill="white" textAnchor="middle" dy=".3em" fontWeight="bold">PPK</text>
      </>
    )
  },
  GAW: {
    viewBox: "0 0 80 80",
    content: (
      <>
        <path d="M71.2671 2.57064C72.1898 2.56211 73.1146 2.56318 74.0394 2.56744C74.0415 2.69758 74.0447 2.96104 74.0468 3.09118C73.6895 3.10398 73.3343 3.11464 72.9802 3.12531C72.993 4.01171 72.9823 4.89917 72.9802 5.78557C72.7626 5.78877 72.545 5.79091 72.3306 5.79517C72.322 4.90344 72.3306 4.01278 72.3274 3.12211C71.9775 3.11678 71.6276 3.11464 71.2788 3.11678C71.2767 2.98131 71.2692 2.70931 71.2671 2.57064Z" fill="white"/>
        <path d="M23.2109 69.7323C23.7058 69.7248 24.221 69.7035 24.6509 69.9947C24.7682 70.528 25.021 71.152 24.6327 71.6374C24.3085 72.1003 23.7047 72.08 23.2034 72.1088C23.1639 71.3174 23.213 70.5248 23.2109 69.7323Z" fill="white"/>
        <path d="M74.5483 2.61126C74.9313 2.59313 75.3131 2.57286 75.6982 2.56433C75.9499 3.30779 76.2059 4.04913 76.4907 4.78193C76.8011 4.05979 77.0529 3.31526 77.3089 2.57286C77.6225 2.57073 77.9339 2.56539 78.2518 2.56006C78.2625 3.63526 78.255 4.70939 78.255 5.78459C78.1046 5.78779 77.8049 5.79419 77.6545 5.79739C77.6438 4.95793 77.6491 4.11953 77.647 3.28219C77.3313 4.10673 77.0593 4.94726 76.7766 5.78246C76.5953 5.78566 76.4161 5.79099 76.2379 5.79739C75.9691 5.02299 75.7281 4.24113 75.4145 3.48486C75.3078 4.24646 75.3675 5.01553 75.3633 5.78033C75.0934 5.78566 74.8267 5.78246 74.5601 5.77499C74.5611 4.72006 74.5825 3.66513 74.5483 2.61126Z" fill="white"/>
        <path d="M3.47314 6.68797C4.18248 6.5141 4.89501 6.7317 5.60754 6.76797C6.87688 6.86717 8.14941 6.74023 9.41981 6.68263C10.143 6.6517 10.8598 6.80637 11.583 6.7989C13.455 6.71143 15.3291 6.6197 17.2033 6.72103C19.439 6.7829 21.679 6.51197 23.9115 6.72103C25.7846 6.8789 27.6545 6.52903 29.5297 6.65917C32.8043 6.81917 36.0886 6.5973 39.359 6.88743C40.6177 6.9813 41.8785 6.87997 43.1382 6.94503C45.5009 7.07197 47.8571 6.73703 50.2198 6.74343C51.9649 6.7541 53.7238 6.56743 55.4571 6.84263C56.1067 6.9621 56.7521 6.80637 57.3899 6.70077C58.2603 6.5557 59.1467 6.61543 60.0267 6.6357C61.4614 6.68477 62.8971 6.54503 64.3297 6.6901C66.2774 6.8693 68.2326 6.68797 70.1803 6.58663C70.4321 6.5653 70.6859 6.5941 70.9366 6.63037C70.0321 7.07303 69.0827 7.41223 68.1547 7.8005C66.3073 8.64423 64.2465 8.87783 62.383 9.67037C61.5041 10.5376 60.1729 10.129 59.0795 10.3029C57.7046 10.5493 56.3062 10.3861 54.9227 10.4789C54.1942 10.5429 53.4806 10.3189 52.7542 10.3701C48.2187 10.5184 43.6811 10.4373 39.1435 10.4576C28.4609 10.4469 17.7761 10.416 7.09234 10.4469C7.08381 10.7221 7.04114 10.9941 7.04754 11.2704C7.10408 14.656 7.01128 18.0416 7.10194 21.4261C7.10941 21.8304 7.02088 22.2282 6.93874 22.6218C5.86354 21.9776 4.55368 22.1141 3.36114 22.2261C3.18194 20.3904 3.38141 18.5504 3.41021 16.7136C3.51901 14.9621 3.28648 13.2117 3.38674 11.4602C3.42834 10.7296 3.40701 9.99677 3.31741 9.27143C3.20114 8.4053 3.37928 7.54343 3.47314 6.68797Z" fill="white"/>
        <path d="M73.9637 7.69294C75.44 7.3644 76.8779 6.82254 78.3989 6.72974C78.0853 7.64707 77.3472 8.33507 77.0293 9.25027C76.6379 10.3383 76.2528 11.4412 75.6821 12.4492C75.3355 13.1255 74.5141 13.1927 73.9232 13.5532C73.3408 13.918 72.6336 13.7943 71.9904 13.9052C70.9333 14.0993 69.9648 14.6156 68.9088 14.8087C68.0875 14.9687 67.248 15.0177 66.4331 15.2097C63.7269 16.0343 60.9856 16.7457 58.2165 17.3228C58.2507 17.3676 58.32 17.4625 58.3541 17.5073C56.0107 18.1207 53.6576 18.6913 51.3003 19.246C47.6352 20.3127 43.8229 20.8268 40.2037 22.0545C42.9856 22.0023 45.6917 21.262 48.4245 20.8119C49.0069 20.6977 49.632 20.9175 50.1835 20.638C50.8832 20.3191 51.6523 20.2295 52.4032 20.1025C53.9659 19.8412 55.488 19.1724 57.0987 19.4103C59.3653 18.6209 61.7685 18.3244 64.1547 18.1484C65.5488 18.0065 66.9835 18.0161 68.32 17.5297C68.2869 17.4775 68.224 17.374 68.1909 17.3207C68.7563 17.2588 69.3259 17.2087 69.8923 17.1233C71.1072 16.9623 72.2464 16.3959 73.4923 16.4364C73.5008 17.1233 73.3259 17.806 72.8757 18.3383C72.3371 19.0071 72.0939 19.8412 71.6587 20.5708C71.3013 21.2385 70.1877 21.1852 70.1067 22.0375C70.0341 22.8097 69.6299 23.8167 68.7467 23.8967C65.8773 23.7463 63.0453 24.3575 60.1888 24.51C58.6944 24.5804 57.1968 24.5431 55.7045 24.6497C55.4411 24.6583 55.1765 24.7255 54.9931 24.9239C54.7989 24.6881 54.5792 24.4737 54.3712 24.2551C54.2283 24.5143 54.0843 24.7756 53.9509 25.0423C53.4827 25.0945 53.0133 25.1383 52.5525 25.2311C51.1285 25.5287 49.6672 25.5052 48.2219 25.5415C46.3435 25.5575 44.4683 25.774 42.5877 25.6865C42.1653 25.6609 41.7483 25.7431 41.3397 25.8391C41.3472 25.95 41.36 26.1687 41.3675 26.2796C42.6784 26.2156 43.9787 26.3852 45.2832 26.4876C45.3589 26.5569 45.5136 26.6945 45.5893 26.7628C46.3477 26.6828 47.1072 26.5164 47.8741 26.5964C49.4432 26.7468 51.0005 26.2049 52.5675 26.4801C53.4229 26.6327 54.2592 26.2732 55.1157 26.366C56.0096 26.4929 56.9131 26.2156 57.8016 26.4257C58.768 26.6337 59.7568 26.5217 60.7317 26.4513C61.3525 26.3756 61.9253 26.6903 62.5323 26.7329C63.1381 26.6636 63.7312 26.3831 64.3509 26.4844C65.8091 26.8833 67.2235 26.0545 68.6944 26.1708C68.6816 26.3649 68.6656 26.5591 68.6432 26.7532C68.2656 27.2609 67.6981 27.678 67.5765 28.3329C67.4389 28.9911 67.2501 29.6364 66.9931 30.2604C66.9461 30.2455 66.848 30.2145 66.7989 30.2007C66.3765 31.1287 65.7973 32.2007 64.7083 32.4225C63.9808 32.4257 63.2597 32.2871 62.5355 32.2433C61.7248 32.1868 60.9845 31.8231 60.1995 31.6556C59.5371 31.5159 58.8608 31.6865 58.1952 31.6225C57.6949 31.5681 57.216 31.4028 56.7232 31.3143C56.0107 31.1841 55.2832 31.4049 54.5728 31.2524C53.4155 30.9932 52.2101 31.0188 51.0987 30.574C50.3829 30.6145 49.6555 30.7351 48.9515 30.5217C47.9381 30.2263 46.8587 30.3671 45.8507 30.0577C44.7957 29.7313 43.68 29.8017 42.6005 29.6279C42.3232 29.5703 42.1237 29.8433 41.8912 29.9415C42.8288 30.5505 43.9819 30.4801 45.0101 30.8172C45.5285 30.9719 45.8517 31.4305 46.2635 31.7495C47.2715 31.4305 48.2944 31.8092 49.3205 31.7857C50.3285 31.9649 51.3013 32.334 52.3328 32.4023L52.2389 32.6071C53.5541 32.7777 54.8779 32.9207 56.1664 33.2364C56.6795 33.3452 57.0731 33.7025 57.3856 34.1089C58.6731 33.7623 59.9787 34.1633 61.2395 34.4279C62.1248 34.6369 63.0784 34.3916 63.92 34.8119C63.8432 35.8401 63.0453 36.5601 62.544 37.3975C62.3477 37.7516 62.0128 37.9692 61.6224 38.0535C61.6864 38.3777 61.8741 38.7351 61.6533 39.0433C61.1925 39.9031 60.8896 40.8769 60.2176 41.6044C59.6459 41.6588 59.1061 41.3452 58.5813 41.1585C57.6043 40.6743 56.5632 40.35 55.5307 40.0087L55.6245 39.7836C54.7541 39.1468 53.632 39.1617 52.7104 38.6465C51.9339 38.238 51.0165 38.2017 50.2645 37.7399C49.7984 37.4604 49.2704 37.3281 48.7467 37.2108C48.0085 37.0753 47.5029 36.4471 46.7957 36.2337C46.2133 36.0481 45.6203 35.8999 45.0517 35.6801C43.9616 35.2631 42.7445 35.2161 41.7035 34.67C41.0485 34.1047 40.1621 33.9863 39.3387 33.8487C38.6059 33.87 37.8485 33.9393 37.1861 33.5553C38.2123 37.3708 38.9856 41.2449 39.9349 45.0796C40.3467 46.6849 40.6347 48.318 41.0432 49.9255C41.3408 51.2108 41.7397 52.4748 41.9605 53.7815C41.7035 53.9137 41.4453 54.046 41.1915 54.1825C41.5925 56.2903 42.1237 58.3703 42.5899 60.462C42.9707 62.1794 43.3333 63.902 43.5744 65.6449C43.6203 65.6161 43.7088 65.5575 43.7536 65.5287C43.8677 65.79 43.9893 66.0524 44.1088 66.3159C53.0293 66.318 61.9499 66.2711 70.8683 66.3393C70.8043 63.55 70.8555 60.7596 70.8107 57.9703C70.8032 47.4412 70.7957 36.9121 70.7744 26.3831C70.7957 25.4871 70.6816 24.5751 70.8651 23.6919C71.4325 22.3041 72.5984 21.2759 73.2555 19.9404C73.4475 19.5489 73.7088 19.1991 74.0021 18.878C74.4651 20.0535 74.0651 21.3079 74.1077 22.5228C74.0192 24.2839 74.4469 26.0151 74.4064 27.7761C74.4693 29.7377 73.9008 31.7207 74.4011 33.6631C74.4395 36.0257 74.416 38.3927 74.4032 40.7575C74.0747 45.6087 74.5771 50.4727 74.3797 55.3271C74.2581 56.4044 74.2123 57.4871 74.2581 58.5719C74.3456 61.4807 74.3776 64.3916 74.4053 67.3015C74.5376 70.1537 73.9701 72.99 74.1781 75.8412C74.2197 76.269 74.3723 76.6775 74.4704 77.0946C74.4597 77.182 74.4395 77.3559 74.4288 77.4423C65.5157 77.3676 56.5984 77.4295 47.6853 77.3207C45.4997 77.3111 43.3152 77.2044 41.1328 77.341C38.9547 77.4711 36.7659 77.4551 34.5973 77.2065C33.3312 77.0849 32.0715 77.3122 30.8085 77.341C26.1568 77.4338 21.504 77.4156 16.8544 77.3441C15.52 77.326 14.1867 77.23 12.8544 77.3047C9.71734 77.5617 6.57067 77.2706 3.42934 77.4082C3.42721 77.182 3.42721 76.9548 3.42721 76.7319C3.44747 73.4092 3.46347 70.0897 3.41441 66.7671C3.37494 64.7703 3.29067 62.7682 3.47201 60.7756C3.44641 59.934 3.25654 59.102 3.33014 58.2583C3.48267 56.6391 3.30987 55.0156 3.35787 53.3943C3.39201 51.8679 3.32907 50.3425 3.32161 48.8151C3.31094 47.422 3.50827 46.0332 3.43254 44.6401C3.30347 42.6039 3.38774 40.5612 3.28214 38.5249C3.32374 38.5089 3.40907 38.4801 3.45281 38.4631C4.19307 40.0097 4.16321 41.7473 4.66987 43.3591C4.76587 43.7239 4.85867 44.0897 4.94934 44.4567L5.12747 44.302C5.85067 46.5089 6.41707 48.7671 6.75201 51.0679C6.83947 51.9308 7.30561 52.7937 6.98454 53.6588C7.25441 54.5889 7.11681 55.5575 7.07734 56.5079C7.09227 59.7847 7.09547 63.0636 7.07201 66.3383C15.9488 66.2657 24.8256 66.3276 33.7024 66.3052C35.0336 66.2817 36.3669 66.4353 37.696 66.3137C37.3835 64.7105 36.9035 63.1457 36.6101 61.5372C36.4469 60.9911 36.5589 60.4311 36.5813 59.8785C36.4651 59.5756 36.1077 59.5009 35.8645 59.3399C35.4688 58.1687 35.4261 56.894 34.9376 55.7569C34.6859 55.7516 34.4352 55.7495 34.1845 55.7495C32.6069 48.9687 31.0368 42.1868 29.4443 35.4081C28.3669 35.4881 27.3301 35.8199 26.3179 36.1719C25.7973 36.6103 25.3781 37.1639 24.816 37.5553C24.1013 38.0663 23.648 38.8503 22.9333 39.3559C21.9083 41.5009 21.1531 43.7772 20.7808 46.1239C20.8821 46.9612 20.8405 47.8305 21.1435 48.6316C21.3301 49.1287 21.4251 49.6524 21.4283 50.1857C20.3296 50.3649 19.2373 50.5879 18.1536 50.8385C16.9227 51.3441 15.5712 51.4007 14.3168 51.8305C13.744 52.0247 13.1467 52.1292 12.5483 52.2188C12.5717 52.5121 12.5739 52.8087 12.5536 53.1052C11.2555 53.4007 9.96267 53.7196 8.66027 54.0012C8.37014 53.1927 8.25921 52.3361 8.04587 51.5063C7.83361 50.5559 7.49974 49.6161 7.51787 48.6305C7.59254 47.918 7.11574 47.3356 6.95787 46.6732C6.65494 45.4945 6.39894 44.3052 6.10561 43.1244C5.77601 41.7079 5.40907 40.3009 5.16801 38.8663L4.96534 38.9825C4.75521 37.8999 4.46081 36.8375 4.20587 35.7655C4.16107 35.1756 4.17707 34.5825 4.14827 33.9937C3.95627 33.7527 3.68747 33.5479 3.60001 33.2428C3.12321 30.8236 2.55681 28.4204 1.99681 26.0204C1.83681 25.4551 1.69067 24.8833 1.60107 24.3009C3.01227 24.0556 4.37014 23.5244 5.79521 23.3943C5.93707 23.7335 6.06721 24.078 6.17921 24.4279C7.17867 24.1868 8.18347 23.982 9.21494 23.982C10.6581 23.1873 12.3232 23.0348 13.9008 22.6604C14.9749 22.4193 16.0139 22.0215 17.1179 21.9308C19.7205 21.4252 22.2667 20.6689 24.8555 20.0972C25.1349 20.0097 25.4869 20.0481 25.7045 19.8199C25.552 19.2545 25.2896 18.7191 25.2459 18.1281C26.1888 17.934 27.1339 17.7495 28.0715 17.5329C28.0373 17.4881 27.968 17.4007 27.9339 17.3569C29.6661 17.0636 31.3536 16.5697 33.0645 16.1783C33.2043 16.8097 33.3077 17.4476 33.4432 18.0791C34.2645 18.0097 35.0613 17.7943 35.8464 17.5585C35.8283 17.5073 35.7888 17.406 35.7685 17.3569C36.6208 17.0455 37.5221 17.0231 38.4032 17.2215C38.6731 16.9644 38.9547 16.6807 39.3461 16.6316C41.1744 16.2903 42.8843 15.486 44.7371 15.2556C44.9856 15.3612 45.2064 15.5479 45.4805 15.5841C45.9008 15.3644 46.2688 15.0497 46.7104 14.8609C47.7675 14.4055 48.928 14.3255 50.0459 14.094C50.8597 13.9255 51.6 13.5159 52.4128 13.3324C54.3221 12.9175 56.2507 12.5783 58.1728 12.2295C59.1232 11.9233 60.0917 11.6652 61.0848 11.5479C62.2507 11.4295 63.3024 10.8876 64.4213 10.5836C65.3024 10.3404 66.1803 10.0844 67.0784 9.90734L66.944 9.75374C68.2112 9.42947 69.456 9.01347 70.6656 8.5164C71.7141 8.05667 72.8779 8.02467 73.9637 7.69294ZM5.13494 68.0481C5.14561 68.1729 5.16587 68.4257 5.17654 68.5505C5.68961 68.7553 5.84001 69.3377 6.01281 69.8071C6.53014 71.7036 7.21494 73.5532 7.67361 75.4668C8.01494 75.4647 8.35521 75.4636 8.69654 75.4615C9.03894 74.2306 9.40587 73.0028 9.83361 71.7964C10.2293 73.0092 10.5824 74.2359 10.9269 75.4636C11.264 75.4615 11.6032 75.4615 11.9403 75.4604C12.1792 74.5196 12.5365 73.614 12.7637 72.6711C12.816 72.686 12.9216 72.7148 12.9739 72.7308C13.2 71.8273 13.5637 70.9665 13.7483 70.0545C13.8784 69.4711 14.1024 68.8001 14.7136 68.5676C14.7371 68.3969 14.7605 68.2306 14.7829 68.0631C13.9925 68.0663 13.2011 68.0609 12.4107 68.0609C12.4267 68.2263 12.4437 68.3927 12.4597 68.5601C12.7605 68.6049 13.0709 68.6487 13.3429 68.7991C13.2075 69.374 13.0368 69.9447 12.9771 70.5367C12.9248 70.5111 12.8171 70.4588 12.7648 70.4311C12.4821 71.4828 12.1504 72.5217 11.7931 73.5521C11.2 71.9799 10.7051 70.3639 10.3947 68.7116C10.6027 68.6487 10.8117 68.5879 11.0219 68.5303C11.0347 68.4129 11.0581 68.1729 11.0709 68.0535C10.1803 68.0695 9.28961 68.0716 8.40001 68.0481C8.40321 68.1751 8.40854 68.4311 8.41281 68.558C8.50561 68.5857 8.69014 68.6433 8.78294 68.6721C9.09334 69.2748 9.31627 69.918 9.46347 70.5804C9.16481 71.5724 8.86507 72.5666 8.52054 73.5415C7.97441 71.9511 7.39094 70.3244 7.23841 68.6412C7.37067 68.6156 7.63734 68.5633 7.76961 68.5377C7.76427 68.4129 7.74934 68.1644 7.74401 68.0396C6.87361 68.0801 6.00321 68.0748 5.13494 68.0481ZM67.0549 69.0508C67.0571 69.2481 67.0624 69.4476 67.0688 69.6492C67.3195 69.6823 67.5733 69.7186 67.8272 69.7559C67.8123 71.4466 67.952 73.1468 67.7632 74.83C67.5307 74.8482 67.3003 74.8663 67.072 74.8865C67.0667 75.0241 67.0539 75.3015 67.0485 75.4391C68.0021 75.4156 68.9579 75.4028 69.9136 75.4465C69.904 75.2577 69.8976 75.0711 69.8923 74.8865C69.6544 74.8609 69.4208 74.8343 69.1872 74.8087C69.12 74.078 69.1019 73.3431 69.1221 72.6113C69.2075 72.6348 69.376 72.6817 69.4592 72.7041C69.9883 73.6204 70.5216 74.5335 71.0464 75.4519C71.6011 75.4551 72.1557 75.4551 72.7125 75.454C72.7104 75.3271 72.704 75.0732 72.7019 74.9463C72.4576 74.8343 72.1941 74.7233 72.0469 74.4855C71.5861 73.8305 71.1925 73.133 70.7701 72.4545C71.1712 72.2892 71.6331 72.1431 71.8656 71.7441C72.208 71.2257 72.1227 70.5655 72 69.9937C71.7931 69.39 71.1189 69.1105 70.5259 69.0999C69.3685 69.0583 68.2027 69.2268 67.0549 69.0508ZM16.5707 69.0903C16.0715 70.7073 15.5477 72.3202 14.9056 73.8882C14.7168 74.2743 14.6496 74.8418 14.1397 74.9218C14.1365 75.0519 14.1248 75.3132 14.1195 75.4444C14.7339 75.4241 15.3493 75.4241 15.9659 75.4391C15.9616 75.3036 15.9552 75.0295 15.9509 74.8919C15.8208 74.8716 15.5616 74.8321 15.4304 74.8119C15.5296 74.3927 15.6512 73.9799 15.7931 73.5746C16.4096 73.5767 17.0261 73.5692 17.6448 73.5692C17.7749 73.9628 17.9435 74.3521 17.9787 74.7713C17.8539 74.8023 17.6053 74.862 17.4816 74.8908C17.4635 75.0743 17.4475 75.2588 17.4347 75.4434C18.2539 75.4231 19.0741 75.4252 19.8933 75.438C19.8859 75.3132 19.872 75.0625 19.8645 74.9377C19.6981 74.8129 19.4475 74.7543 19.3835 74.5356C18.6784 72.7532 18.032 70.9452 17.5104 69.1009C17.1979 69.0967 16.8821 69.0924 16.5707 69.0903ZM21.1403 69.0977C21.1424 69.2353 21.1456 69.5127 21.1477 69.6513C21.3909 69.6801 21.6341 69.7111 21.8784 69.7441C21.9541 71.422 21.9595 73.1041 21.8912 74.7841C21.6448 74.8225 21.3995 74.8663 21.1573 74.9143C21.1467 75.0882 21.1371 75.2641 21.1264 75.4401C22.0843 75.4135 23.0411 75.4007 23.9968 75.4476C23.9915 75.31 23.9787 75.0327 23.9733 74.894C23.7408 74.8663 23.5093 74.8396 23.2789 74.814C23.1936 74.0545 23.1541 73.2876 23.248 72.5292C24.1131 73.3218 24.4779 74.5026 25.1392 75.4562C25.696 75.4583 26.2549 75.4562 26.8128 75.454C26.8107 75.3239 26.8053 75.0636 26.8021 74.9356C26.5632 74.8396 26.2869 74.7617 26.1515 74.5239C25.6821 73.8636 25.2939 73.1511 24.848 72.4759C25.2139 72.2978 25.6437 72.1676 25.8891 71.8199C26.3029 71.2503 26.2464 70.4684 26.0107 69.8434C25.6896 69.2194 24.9227 69.0668 24.2827 69.0903C23.2341 69.1159 22.1867 69.1468 21.1403 69.0977ZM27.9243 69.0977C27.9243 69.2353 27.9221 69.5095 27.9211 69.6471C28.2315 69.6855 28.5429 69.7303 28.8555 69.7719C28.8277 71.4583 28.9568 73.1543 28.7797 74.8354C28.4928 74.8556 28.2048 74.8737 27.92 74.8919C27.9232 75.0316 27.9285 75.3111 27.9328 75.4508C28.9269 75.4305 29.92 75.4071 30.9141 75.4562C30.9173 75.3196 30" fill="white"/>
      </>
    )
  },
  AMZN: {
    viewBox: "0 0 1769 464",
    content: (
      <>
        <path d="M9.643,37.76c-8.098,6.394 -9.803,17.047 -5.115,31.967c4.262,13.213 14.278,29.619 30.048,49.227c63.504,78.426 139.157,143.634 226.958,195.633c87.8,51.999 181.783,90.356 281.943,115.076c100.585,25.148 203.301,37.72 308.149,37.72c134.259,0 262.123,-19.603 383.594,-58.818c121.47,-38.786 222.909,-93.341 304.319,-163.666c28.554,-25.144 42.833,-45.176 42.833,-60.096c0,-5.541 -2.344,-11.082 -7.031,-16.622c-6.394,-6.39 -14.067,-8.522 -23.017,-6.39c-8.95,2.127 -21.522,7.456 -37.72,15.982c-77.997,40.918 -173.041,73.521 -285.136,97.816c-111.667,24.72 -228.237,37.079 -349.708,37.079c-150.453,0 -295.793,-20.457 -436.018,-61.374c-140.224,-40.917 -264.467,-104.848 -372.724,-191.795c-15.769,-12.36 -28.558,-20.248 -38.359,-23.658c-9.377,-3.409 -17.048,-2.768 -23.015,1.919Z" fill="white"/>
        <path d="M1430.188,69.763c-8.95,8.526 -11.294,17.476 -7.031,26.855c2.985,6.819 8.738,10.653 17.264,11.507c8.522,1.278 20.669,0.425 36.438,-2.556c25.573,-5.541 52.212,-9.379 79.916,-11.511c27.704,-1.703 51.787,-1.278 72.244,1.278c20.461,2.985 33.245,8.101 38.361,15.345c7.672,11.51 4.9,35.801 -8.313,72.885c-12.784,37.079 -30.26,73.093 -52.424,108.045c-8.526,14.062 -13.638,25.144 -15.345,33.245c-1.703,8.097 0.429,14.916 6.394,20.457c3.834,3.834 8.097,5.753 12.784,5.753c12.364,0 30.264,-10.869 53.706,-32.604c42.196,-36.655 71.815,-80.128 88.866,-130.421c9.375,-26.002 15.128,-53.277 17.26,-81.835c2.131,-28.554 -1.066,-49.014 -9.591,-61.374c-8.097,-11.935 -25.998,-21.739 -53.702,-29.407c-27.276,-7.672 -54.768,-11.51 -82.472,-11.51c-54.131,0 -105.489,12.789 -154.075,38.361c-17.901,9.804 -31.326,18.966 -40.28,27.488Z" fill="white"/>
      </>
    )
  },
  CRWD: {
    viewBox: "0 0 7826 5400",
    content: (
      <>
        <path d="M2.781,10.178c0,19.669 145.785,314.71 163.14,329.751c3.471,3.471 18.512,26.611 33.554,52.066c15.041,25.454 40.496,59.008 54.38,75.206c15.041,16.198 26.611,32.397 26.611,35.868c0,3.471 10.413,19.669 24.297,34.711c12.727,15.041 50.909,59.008 83.306,97.19c149.256,173.553 364.462,374.875 592.395,553.056c6.942,4.628 24.297,18.512 39.339,31.24c15.041,12.727 31.24,23.14 34.711,23.14c3.471,0 20.826,11.57 35.868,25.454c41.653,37.025 83.306,65.95 301.983,211.735c202.479,134.215 205.95,137.686 288.098,186.28c28.926,17.355 59.008,39.339 67.107,47.438c8.099,8.099 20.826,15.041 26.611,15.041c8.099,0 124.958,65.95 183.966,104.132c9.256,6.942 30.083,18.512 46.281,25.454c41.653,20.826 273.057,160.826 341.321,207.107c196.694,131.9 445.453,357.52 520.66,469.751c31.24,47.438 52.066,62.479 52.066,37.025c0,-15.041 -47.438,-101.818 -65.95,-123.801c-8.099,-8.099 -15.041,-20.826 -15.041,-26.611c0,-12.727 -69.421,-126.115 -90.248,-148.099c-8.099,-9.256 -24.297,-30.083 -34.711,-46.281c-31.24,-47.438 -69.421,-90.248 -187.438,-209.421c-142.314,-141.157 -158.512,-153.884 -358.677,-303.14c-92.562,-68.264 -172.396,-128.429 -179.338,-134.215c-5.785,-4.628 -32.397,-21.983 -57.851,-37.025c-25.454,-15.041 -48.595,-31.24 -52.066,-34.711c-3.471,-3.471 -26.611,-19.669 -52.066,-34.711c-25.454,-15.041 -98.347,-61.322 -161.983,-102.975c-128.429,-84.463 -150.413,-98.347 -187.438,-118.016c-15.041,-8.099 -26.611,-18.512 -26.611,-24.297c0,-4.628 -5.785,-9.256 -11.57,-9.256c-6.942,0 -34.711,-16.198 -61.322,-35.868c-45.124,-32.397 -183.966,-130.743 -231.404,-163.14c-12.727,-8.099 -32.397,-24.297 -45.124,-35.868c-13.884,-10.413 -27.769,-19.669 -31.24,-19.669c-3.471,0 -19.669,-11.57 -35.868,-26.611c-16.198,-13.884 -61.322,-50.909 -100.661,-80.992c-39.339,-30.083 -78.677,-61.322 -86.777,-69.421c-8.099,-8.099 -43.967,-37.025 -78.677,-64.793c-149.256,-116.859 -658.345,-605.122 -709.254,-680.329c-21.983,-32.397 -54.38,-52.066 -54.38,-32.397Z" fill="white"/>
        <path d="M2146.4,1165.432c-9.256,9.256 3.471,50.909 15.041,50.909c5.785,0 10.413,5.785 10.413,13.884c0,17.355 83.306,183.966 101.818,203.636c6.942,8.099 13.884,19.669 13.884,25.454c0,15.041 99.504,158.512 148.099,212.892c115.702,129.586 326.28,325.123 407.272,378.346c16.198,10.413 45.124,33.554 63.636,49.752c19.669,17.355 55.537,45.124 80.992,62.479c25.454,17.355 56.694,40.496 68.264,50.909c12.727,11.57 43.967,34.711 69.421,52.066c26.611,18.512 57.851,41.653 69.421,52.066c12.727,11.57 43.967,34.711 69.421,52.066c26.611,17.355 49.752,34.711 53.223,38.182c3.471,3.471 42.81,34.711 86.777,69.421c45.124,34.711 86.777,68.264 93.719,75.206c6.942,5.785 53.223,47.438 102.975,92.562c168.925,151.57 298.512,292.726 377.189,410.743c76.363,115.702 106.446,166.611 174.71,298.512c35.868,71.735 89.091,166.611 115.702,211.735c27.769,45.124 62.479,102.975 77.52,129.586c15.041,26.611 34.711,55.537 43.967,63.636c8.099,8.099 15.041,20.826 15.041,26.611c0,5.785 5.785,17.355 11.57,25.454c6.942,8.099 61.322,89.091 122.644,181.652c195.537,296.198 463.966,532.23 727.767,637.519c124.958,49.752 386.445,69.421 728.924,54.38c238.346,-9.256 511.404,-2.314 558.841,15.041c15.041,5.785 48.595,10.413 75.206,10.413c26.611,1.157 69.421,8.099 94.876,17.355c25.454,9.256 56.694,17.355 69.421,17.355c12.727,0 38.182,8.099 56.694,17.355c17.355,9.256 40.496,17.355 49.752,17.355c18.512,0 82.149,27.769 229.09,99.504c211.735,105.289 382.974,230.247 563.47,411.9c120.33,121.487 124.958,124.958 131.9,94.876c9.256,-35.868 -2.314,-158.512 -17.355,-186.28c-5.785,-11.57 -23.14,-47.438 -38.182,-78.677c-28.926,-64.793 -83.306,-142.314 -164.297,-236.032c-31.24,-38.182 -53.223,-75.206 -53.223,-91.405c0,-47.438 -45.124,-121.487 -98.347,-160.826c-67.107,-49.752 -273.057,-153.884 -304.297,-153.884c-5.785,0 -26.611,-8.099 -43.967,-17.355c-18.512,-9.256 -42.81,-17.355 -54.38,-17.355c-10.413,0 -28.926,-4.628 -40.496,-10.413c-10.413,-5.785 -59.008,-21.983 -106.446,-35.868c-158.512,-47.438 -260.33,-83.306 -296.198,-105.289c-38.182,-23.14 -74.049,-83.306 -74.049,-123.801c0,-30.083 43.967,-166.611 57.851,-180.495c6.942,-6.942 11.57,-19.669 11.57,-28.926c0,-10.413 6.942,-32.397 16.198,-49.752c9.256,-16.198 21.983,-67.107 30.083,-112.231c38.182,-224.462 -83.306,-367.933 -474.379,-563.47c-52.066,-25.454 -146.942,-68.264 -190.909,-86.777c-12.727,-4.628 -47.438,-19.669 -77.52,-32.397c-30.083,-13.884 -62.479,-24.297 -71.735,-24.297c-9.256,0 -20.826,-5.785 -24.297,-11.57c-3.471,-6.942 -15.041,-11.57 -25.454,-11.57c-9.256,0 -33.554,-6.942 -53.223,-16.198c-20.826,-9.256 -120.33,-43.967 -222.148,-76.363c-101.818,-33.554 -193.223,-64.793 -203.636,-69.421c-10.413,-5.785 -39.339,-13.884 -63.636,-18.512c-25.454,-3.471 -49.752,-11.57 -56.694,-16.198c-5.785,-4.628 -30.083,-12.727 -52.066,-16.198c-21.983,-4.628 -50.909,-12.727 -63.636,-18.512c-12.727,-4.628 -46.281,-15.041 -75.206,-23.14c-28.926,-6.942 -72.892,-18.512 -98.347,-24.297c-25.454,-6.942 -56.694,-17.355 -69.421,-21.983c-12.727,-5.785 -41.653,-13.884 -63.636,-18.512c-21.983,-3.471 -47.438,-11.57 -57.851,-16.198c-9.256,-4.628 -56.694,-20.826 -104.132,-34.711c-47.438,-13.884 -94.876,-28.926 -104.132,-33.554c-10.413,-5.785 -35.868,-13.884 -57.851,-18.512c-21.983,-4.628 -45.124,-11.57 -52.066,-16.198c-5.785,-4.628 -50.909,-20.826 -98.347,-35.868c-47.438,-13.884 -91.405,-30.083 -98.347,-34.711c-5.785,-4.628 -45.124,-19.669 -86.777,-34.711c-41.653,-15.041 -79.834,-31.24 -85.62,-37.025c-6.942,-4.628 -18.512,-9.256 -27.769,-9.256c-23.14,0 -131.9,-49.752 -407.272,-183.966c-193.223,-94.876 -371.404,-192.066 -410.743,-223.305c-5.785,-4.628 -53.223,-35.868 -104.132,-69.421c-50.909,-33.554 -97.19,-64.793 -104.132,-69.421c-5.785,-4.628 -60.165,-45.124 -120.33,-90.248c-209.421,-156.198 -513.718,-448.924 -642.147,-619.007c-24.297,-32.397 -45.124,-59.008 -46.281,-61.322c-2.314,-1.157 -5.785,1.157 -9.256,4.628Zm5174.201,3505.776c118.016,39.339 156.198,69.421 183.966,140c27.769,68.264 -18.512,84.463 -75.206,25.454c-18.512,-19.669 -52.066,-46.281 -74.049,-60.165c-21.983,-13.884 -47.438,-31.24 -55.537,-39.339c-8.099,-8.099 -21.983,-15.041 -31.24,-15.041c-15.041,0 -28.926,-24.297 -28.926,-53.223c0,-20.826 16.198,-20.826 80.992,2.314Zm-6004.943,-2776.852c-0,12.727 98.347,207.107 115.702,227.933c6.942,8.099 31.24,39.339 54.38,71.735c84.463,113.388 216.363,248.76 392.23,399.172c43.967,38.182 164.297,128.429 202.479,152.727c16.198,10.413 37.025,26.611 46.281,34.711c9.256,9.256 37.025,28.926 62.479,43.967c25.454,15.041 48.595,31.24 52.066,34.711c6.942,9.256 348.264,211.735 457.024,271.9c85.62,48.595 178.181,94.876 503.304,253.388c190.909,93.719 226.776,112.231 366.776,196.694c105.289,63.636 274.214,195.537 358.677,279.999c47.438,47.438 87.934,85.62 90.248,85.62c3.471,0 -1.157,-12.727 -8.099,-28.926c-6.942,-16.198 -17.355,-28.926 -23.14,-28.926c-4.628,0 -9.256,-6.942 -9.256,-15.041c0,-9.256 -10.413,-28.926 -23.14,-43.967c-12.727,-15.041 -26.611,-33.554 -31.24,-39.339c-84.463,-111.074 -153.884,-178.181 -366.776,-358.677c-28.926,-25.454 -219.834,-155.041 -308.925,-210.578c-70.578,-45.124 -212.892,-124.958 -357.52,-202.479c-34.711,-19.669 -68.264,-39.339 -75.206,-43.967c-10.413,-8.099 -60.165,-34.711 -225.619,-124.958c-104.132,-55.537 -367.933,-218.677 -410.743,-253.388c-5.785,-5.785 -32.397,-23.14 -57.851,-38.182c-25.454,-15.041 -50.909,-32.397 -57.851,-37.025c-5.785,-4.628 -68.264,-50.909 -138.843,-102.975c-69.421,-52.066 -129.586,-98.347 -133.057,-101.818c-3.471,-4.628 -31.24,-27.769 -63.636,-52.066c-64.793,-48.595 -148.099,-124.958 -303.14,-277.685c-59.008,-57.851 -107.603,-99.504 -107.603,-92.562Zm1314.377,2072.226c-11.57,11.57 182.809,192.066 311.239,288.098c63.636,47.438 121.487,90.248 127.272,94.876c30.083,23.14 134.215,83.306 143.471,83.306c5.785,0 18.512,6.942 26.611,13.884c8.099,8.099 33.554,23.14 55.537,34.711c153.884,72.892 219.834,101.818 236.032,101.818c9.256,0 19.669,4.628 23.14,9.256c9.256,15.041 373.718,129.586 414.214,129.586c11.57,0 30.083,4.628 41.653,11.57c10.413,5.785 42.81,16.198 71.735,21.983c100.661,21.983 156.198,35.868 179.338,46.281c12.727,5.785 62.479,21.983 109.917,37.025c47.438,15.041 91.405,30.083 98.347,35.868c5.785,4.628 17.355,9.256 26.611,9.256c9.256,0 32.397,6.942 52.066,16.198c189.752,82.149 240.661,101.818 247.603,96.033c3.471,-4.628 -8.099,-19.669 -26.611,-33.554c-28.926,-23.14 -79.834,-68.264 -189.752,-171.239c-17.355,-16.198 -48.595,-43.967 -69.421,-62.479c-57.851,-49.752 -300.826,-230.247 -352.892,-261.487c-25.454,-15.041 -48.595,-31.24 -52.066,-34.711c-3.471,-4.628 -13.884,-11.57 -23.14,-16.198c-9.256,-4.628 -48.595,-25.454 -86.777,-47.438c-71.735,-41.653 -218.677,-114.545 -300.826,-149.256c-25.454,-10.413 -54.38,-24.297 -63.636,-28.926c-10.413,-5.785 -34.711,-13.884 -55.537,-17.355c-19.669,-4.628 -39.339,-13.884 -42.81,-19.669c-4.628,-5.785 -18.512,-10.413 -32.397,-10.413c-25.454,1.157 -25.454,1.157 -2.314,13.884c12.727,6.942 25.454,16.198 28.926,20.826c3.471,3.471 28.926,20.826 57.851,38.182c61.322,35.868 173.553,135.372 173.553,153.884c0,6.942 -8.099,19.669 -17.355,27.769c-13.884,11.57 -47.438,10.413 -167.768,-4.628c-83.306,-10.413 -163.14,-24.297 -177.024,-30.083c-13.884,-4.628 -54.38,-18.512 -89.091,-28.926c-180.495,-54.38 -543.8,-255.702 -649.089,-358.677c-10.413,-9.256 -21.983,-13.884 -26.611,-9.256Z" fill="white"/>
      </>
    )
  },
  MSFT: {
    viewBox: "0 0 544 544",
    content: (
      <>
        <rect x="0" y="0" width="258.333" height="258.333" fill="#f24f21"/>
        <rect x="285.417" y="0" width="258.333" height="258.333" fill="#80ba00"/>
        <rect x="0" y="285.417" width="258.333" height="258.333" fill="#00a3f0"/>
        <rect x="285.417" y="285.417" width="258.333" height="258.333" fill="#ffba00"/>
      </>
    )
  },
  USDC: {
    viewBox: "0 0 2000 2000",
    content: (
      <>
        <path d="M1000,2000c552.29,0,1000-447.71,1000-1000S1552.29,0,1000,0,0,447.72,0,1000,447.72,2000,1000,2000Z" fill="#2775ca" />
        <path d="M812.5,1685.16c0,23.43-18.75,36.71-40.62,29.68C468.75,1618,250,1335.16,250,1000c0-334.38,218.75-618,521.88-714.85,22.65-7,40.62,6.25,40.62,29.69v58.59c0,15.63-11.72,33.6-26.56,39.07C546.09,500.78,375,731.25,375,1000c0,269.53,171.09,499.22,410.94,586.72,14.84,5.47,26.56,23.44,26.56,39.06Z" fill="#fff" />
        <path d="M1062.51,1468.74a31.35,31.35,0,0,1-31.25,31.25h-62.5a31.34,31.34,0,0,1-31.25-31.25v-98.43c-136.72-18.75-203.13-94.54-221.1-199.22-3.12-18,10.94-33.6,28.91-33.6h71.09c14.85,0,27.35,10.94,30.47,25,13.28,61.72,49.22,109.38,158.6,109.38,80.46,0,138.28-45.31,138.28-112.5s-33.6-93-152.35-112.5c-175-23.44-257.81-76.56-257.81-213.28,0-105.47,80.47-188.28,203.91-205.47V531.24A31.35,31.35,0,0,1,968.76,500h62.5a31.35,31.35,0,0,1,31.25,31.25v99.22c100.78,18,164.84,75,185.93,170.31,3.91,18-10.15,34.38-28.9,34.38h-65.63c-14.06,0-25.78-9.37-29.68-22.66-18-60.15-60.94-86.71-135.94-86.71-82.81,0-125.78,39.84-125.78,96.09,0,59.37,24.22,89.06,151.56,107,171.87,23.44,260.94,72.66,260.94,218.75,0,110.94-82.82,200.78-211.72,221.09v100Z" fill="#fff" />
        <path d="M1228.12,1714.84c-22.65,7-40.62-6.25-40.62-29.69v-58.59c0-17.19,10.16-33.6,26.56-39.07,239.07-87.5,410.94-318,410.94-586.72,0-269.53-171.09-499.22-410.94-586.72-14.84-5.46-26.56-23.43-26.56-39.06V316.4c0-23.44,18.75-36.72,40.62-29.69C1531.25,382,1750,665.62,1750,1000,1750,1335.15,1531.25,1618,1228.12,1714.84Z" fill="#fff" />
      </>
    )
  }
};

const AssetLogo: React.FC<{ name: string }> = ({ name }) => {
  const asset = ASSET_LOGOS[name];

  // Check if an inline SVG definition exists for this asset
  if (asset) {
    return (
      <div className="absolute inset-0 flex items-center justify-center opacity-40 pointer-events-none" style={{ zIndex: 0 }}>
        <svg 
          viewBox={asset.viewBox} 
          className="w-[70%] h-[70%] max-w-[120px] max-h-[120px]"
          style={{ filter: 'drop-shadow(0px 1px 2px rgba(0,0,0,0.1))' }}
        >
          {asset.content}
        </svg>
      </div>
    );
  }

  // Fallback for assets without inline SVG
  return (
    <div className="absolute inset-0 flex items-center justify-center opacity-40 pointer-events-none" style={{ zIndex: 0 }}>
      <img 
        src={`images/${name}.svg`}
        alt=""
        className="w-[70%] h-[70%] max-w-[120px] max-h-[120px] object-contain"
        onError={(e) => {
           // Hide the image completely if it fails to load to avoid broken icon
           e.currentTarget.style.display = 'none';
        }}
      />
    </div>
  );
};

interface TreemapContentProps {
  root?: any;
  depth?: number;
  x?: number;
  y?: number;
  width?: number;
  height?: number;
  index?: number;
  payload?: any;
  colors?: string[];
  name?: string;
  value?: number; // Add value prop type
  roi?: number; // Add roi prop type
}

const TreemapContent: React.FC<TreemapContentProps> = (props) => {
  const { depth, x, y, width, height, index, colors, name, value, roi } = props;
  
  // Ensure we have valid coordinates and dimensions
  if (x === undefined || y === undefined || width === undefined || height === undefined) return null;

  // Only render content for leaf nodes (depth 1 usually in simple treemaps)
  // If the library passes depth, check it. Otherwise just render.
  
  return (
    <g>
      {/* Colored Rectangle */}
      <rect
        x={x}
        y={y}
        width={width}
        height={height}
        fill={(colors && index !== undefined) ? colors[index % colors.length] : '#8884d8'}
        stroke="#fff"
        strokeWidth={2} // Thicker stroke for better separation
      />
      
      {/* Use foreignObject to embed HTML div which allows robust image handling and text wrapping */}
      <foreignObject x={x} y={y} width={width} height={height}>
        <div className="w-full h-full relative flex flex-col items-center justify-center overflow-hidden p-1">
          {/* Asset Logo (Watermark) */}
          {name && <AssetLogo name={name} />}

          {/* Text Content */}
          <div className="relative z-10 text-center pointer-events-none">
             {/* Name: Bold, white, with shadow for readability */}
             <div className="font-black text-white text-sm sm:text-base md:text-lg tracking-tight drop-shadow-md leading-tight mb-0.5">
               {name}
             </div>
             
             {/* ROI: Smaller, colored badge-like look or just contrasting text */}
             {roi !== undefined && (
               <div className={`font-bold text-xs sm:text-sm drop-shadow-sm ${roi >= 0 ? 'text-white' : 'text-rose-200'}`}>
                 {roi > 0 ? '+' : ''}{roi.toFixed(1)}%
               </div>
             )}
          </div>
        </div>
      </foreignObject>
    </g>
  );
};

interface OMFTreemapChartProps {
  data: { name: string; value: number; roi: number }[];
}

export const OMFTreemapChart: React.FC<OMFTreemapChartProps> = ({ data }) => {
  // Define custom colors for the treemap
  // Using a visually pleasing palette that isn't too harsh
  const TREEMAP_COLORS = [
    '#059669', // Emerald 600
    '#2563eb', // Blue 600
    '#7c3aed', // Violet 600
    '#db2777', // Pink 600
    '#ea580c', // Orange 600
    '#0891b2', // Cyan 600
    '#4f46e5', // Indigo 600
    '#be123c', // Rose 700
    '#16a34a', // Green 600
    '#9333ea', // Purple 600
    '#c026d3', // Fuchsia 600
    '#d97706', // Amber 600
    '#0d9488', // Teal 600
    '#57534e', // Stone 600 (for 'Reszta' maybe?)
  ];

  // Filter out very small items that clutter the view? 
  // For now, we keep all as processed in App.tsx, but we might want to group < 1%
  
  return (
    <div className="h-[500px] w-full">
      <ResponsiveContainer width="100%" height="100%">
        <Treemap
          data={data}
          dataKey="value"
          aspectRatio={4 / 3}
          stroke="#fff"
          fill="#8884d8"
          content={<TreemapContent colors={TREEMAP_COLORS} />}
        >
          <Tooltip 
            content={({ active, payload }) => {
              if (active && payload && payload.length) {
                const data = payload[0].payload;
                return (
                  <div className="bg-white p-3 border border-slate-200 rounded-lg shadow-lg">
                    <p className="font-bold text-slate-800">{data.name}</p>
                    <p className="text-sm text-slate-600">
                      Wartość: <span className="font-semibold">{formatCurrency(data.value)}</span>
                    </p>
                    <p className={`text-sm font-semibold ${data.roi >= 0 ? 'text-emerald-600' : 'text-rose-600'}`}>
                      ROI: {data.roi > 0 ? '+' : ''}{data.roi.toFixed(2)}%
                    </p>
                  </div>
                );
              }
              return null;
            }}
          />
        </Treemap>
      </ResponsiveContainer>
    </div>
  );
};

// --- Standard Charts ---

export const ValueCompositionChart: React.FC<ChartProps> = ({ data }) => (
  <div className="h-80 w-full">
    <ResponsiveContainer width="100%" height="100%">
      <AreaChart data={data as any[]}>
        <defs>
          <linearGradient id="colorValue" x1="0" y1="0" x2="0" y2="1">
            <stop offset="5%" stopColor="#4f46e5" stopOpacity={0.8}/>
            <stop offset="95%" stopColor="#4f46e5" stopOpacity={0}/>
          </linearGradient>
          <linearGradient id="colorInvest" x1="0" y1="0" x2="0" y2="1">
            <stop offset="5%" stopColor="#94a3b8" stopOpacity={0.5}/>
            <stop offset="95%" stopColor="#94a3b8" stopOpacity={0}/>
          </linearGradient>
        </defs>
        <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#e2e8f0" />
        <XAxis 
          dataKey="date" 
          tickFormatter={formatDate} 
          stroke="#94a3b8" 
          fontSize={12}
          tickMargin={10}
        />
        <YAxis 
          tickFormatter={(val) => `${(val/1000).toFixed(0)}k`} 
          stroke="#94a3b8" 
          fontSize={12}
        />
        <Tooltip 
          formatter={(value: number) => [`${value.toLocaleString('pl-PL')} zł`]}
          labelFormatter={formatDate}
          contentStyle={{ backgroundColor: '#fff', borderRadius: '8px', border: '1px solid #e2e8f0' }}
        />
        <Legend verticalAlign="top" height={36} />
        <Area 
          type="monotone" 
          dataKey="totalValue" 
          name="Wartość Całkowita" 
          stroke="#4f46e5" 
          fillOpacity={1} 
          fill="url(#colorValue)" 
          strokeWidth={2}
        />
        {/* We conditionally render the investment area if it exists in the data */}
        {data.length > 0 && 'investment' in data[0] && (
           <Area 
             type="monotone" 
             dataKey="investment" 
             name="Wkład Własny" 
             stroke="#94a3b8" 
             fillOpacity={1} 
             fill="url(#colorInvest)" 
             strokeWidth={2}
             strokeDasharray="5 5"
           />
        )}
        {/* For PPK specifically which uses employeeContribution as investment */}
        {data.length > 0 && 'employeeContribution' in data[0] && (
           <Area 
             type="monotone" 
             dataKey="employeeContribution" 
             name="Wkład Własny" 
             stroke="#94a3b8" 
             fillOpacity={1} 
             fill="url(#colorInvest)" 
             strokeWidth={2}
             strokeDasharray="5 5"
           />
        )}
      </AreaChart>
    </ResponsiveContainer>
  </div>
);

export const ROIChart: React.FC<ChartProps> = ({ data }) => (
  <div className="h-80 w-full">
    <ResponsiveContainer width="100%" height="100%">
      <LineChart data={data as any[]}>
        <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#e2e8f0" />
        <XAxis 
          dataKey="date" 
          tickFormatter={formatDate} 
          stroke="#94a3b8" 
          fontSize={12}
          tickMargin={10}
        />
        <YAxis 
          stroke="#94a3b8" 
          fontSize={12} 
          unit="%" 
        />
        <Tooltip 
          formatter={(value: number) => [`${value.toFixed(2)}%`, 'ROI']}
          labelFormatter={formatDate}
          contentStyle={{ backgroundColor: '#fff', borderRadius: '8px', border: '1px solid #e2e8f0' }}
        />
        <ReferenceLine y={0} stroke="#ef4444" strokeDasharray="3 3" />
        <Line 
          type="monotone" 
          dataKey="roi" 
          stroke="#10b981" 
          strokeWidth={2} 
          dot={false} 
          activeDot={{ r: 6 }} 
        />
      </LineChart>
    </ResponsiveContainer>
  </div>
);

export const ContributionComparisonChart: React.FC<ChartProps> = ({ data }) => (
  <div className="h-80 w-full">
    <ResponsiveContainer width="100%" height="100%">
      <BarChart data={data as any[]}>
        <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#e2e8f0" />
        <XAxis 
          dataKey="date" 
          tickFormatter={formatDate} 
          stroke="#94a3b8" 
          fontSize={12}
          tickMargin={10}
        />
        <YAxis 
          tickFormatter={(val) => `${(val/1000).toFixed(0)}k`} 
          stroke="#94a3b8" 
          fontSize={12}
        />
        <Tooltip 
          formatter={(value: number) => [`${value.toLocaleString('pl-PL')} zł`]}
          labelFormatter={formatDate}
          cursor={{fill: '#f1f5f9'}}
          contentStyle={{ backgroundColor: '#fff', borderRadius: '8px', border: '1px solid #e2e8f0' }}
        />
        <Legend verticalAlign="top" height={36} />
        <Bar dataKey="employeeContribution" name="Pracownik" stackId="a" fill="#3b82f6" radius={[0, 0, 4, 4]} />
        <Bar dataKey="employerContribution" name="Pracodawca" stackId="a" fill="#8b5cf6" />
        <Bar dataKey="stateContribution" name="Państwo" stackId="a" fill="#ec4899" radius={[4, 4, 0, 0]} />
      </BarChart>
    </ResponsiveContainer>
  </div>
);

// --- Crypto Specific Charts ---

export const CryptoValueChart: React.FC<ChartProps> = ({ data }) => (
  <div className="h-80 w-full">
    <ResponsiveContainer width="100%" height="100%">
      <AreaChart data={data as any[]}>
        <defs>
          <linearGradient id="colorTotal" x1="0" y1="0" x2="0" y2="1">
            <stop offset="5%" stopColor="#8b5cf6" stopOpacity={0.8}/>
            <stop offset="95%" stopColor="#8b5cf6" stopOpacity={0}/>
          </linearGradient>
          <linearGradient id="colorInvest2" x1="0" y1="0" x2="0" y2="1">
            <stop offset="5%" stopColor="#64748b" stopOpacity={0.5}/>
            <stop offset="95%" stopColor="#64748b" stopOpacity={0}/>
          </linearGradient>
        </defs>
        <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#e2e8f0" />
        <XAxis 
          dataKey="date" 
          tickFormatter={formatDate} 
          stroke="#94a3b8" 
          fontSize={12}
          tickMargin={10}
        />
        <YAxis 
          tickFormatter={(val) => `${(val/1000).toFixed(0)}k`} 
          stroke="#94a3b8" 
          fontSize={12}
        />
        <Tooltip 
          formatter={(value: number) => [`${value.toLocaleString('pl-PL')} zł`]}
          labelFormatter={formatDate}
          contentStyle={{ backgroundColor: '#fff', borderRadius: '8px', border: '1px solid #e2e8f0' }}
        />
        <Legend verticalAlign="top" height={36} />
        <Area 
          type="monotone" 
          dataKey="totalValue" 
          name="Wycena Portfela" 
          stroke="#8b5cf6" 
          fillOpacity={1} 
          fill="url(#colorTotal)" 
          strokeWidth={2}
        />
        <Area 
          type="monotone" 
          dataKey="investment" 
          name="Zainwestowany Kapitał" 
          stroke="#64748b" 
          fillOpacity={1} 
          fill="url(#colorInvest2)" 
          strokeWidth={2}
          strokeDasharray="5 5"
        />
      </AreaChart>
    </ResponsiveContainer>
  </div>
);

export const CryptoProfitChart: React.FC<ChartProps> = ({ data }) => (
  <div className="h-80 w-full">
    <ResponsiveContainer width="100%" height="100%">
      <BarChart data={data as any[]}>
        <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#e2e8f0" />
        <XAxis 
          dataKey="date" 
          tickFormatter={formatDate} 
          stroke="#94a3b8" 
          fontSize={12}
          tickMargin={10}
        />
        <YAxis 
          tickFormatter={(val) => `${(val/1000).toFixed(0)}k`} 
          stroke="#94a3b8" 
          fontSize={12}
        />
        <Tooltip 
          formatter={(value: number) => [`${value.toLocaleString('pl-PL')} zł`, 'Zysk/Strata']}
          labelFormatter={formatDate}
          cursor={{fill: '#f1f5f9'}}
          contentStyle={{ backgroundColor: '#fff', borderRadius: '8px', border: '1px solid #e2e8f0' }}
        />
        <ReferenceLine y={0} stroke="#64748b" />
        <Bar dataKey="profit" name="Zysk/Strata Netto">
          {data.map((entry, index) => (
            <Cell key={`cell-${index}`} fill={(entry.profit || 0) >= 0 ? '#10b981' : '#ef4444'} />
          ))}
        </Bar>
      </BarChart>
    </ResponsiveContainer>
  </div>
);

// --- Global Dashboard Charts ---

export const GlobalSummaryChart: React.FC<ChartProps> = ({ data }) => {
  // We want to show Stacked Area Chart:
  // PPK (Base) + Crypto + IKE
  // However, standard AreaChart stacks on top.
  // We need to calculate individual components for stacking.
  
  const processedData = data.map(row => {
    // We need to extract the components from the row which currently has cumulative totals.
    // Actually, the Global History Data generation logic in App.tsx needs to provide split values
    // OR we assume 'investment' and 'profit' are totals.
    // To do a stacked chart of sources (PPK vs Crypto vs IKE), we need those columns.
    // Let's approximate based on shares or update App.tsx. 
    // Since App.tsx provides 'ppkShare', 'cryptoShare', 'ikeShare' and 'totalValue',
    // we can reconstruct the values.
    
    const r = row as any; // Cast to any to access calculated properties safely
    const total = r.totalValue || 0;

    return {
      ...row,
      ppkValue: total * (r.ppkShare || 0),
      cryptoValue: total * (r.cryptoShare || 0),
      ikeValue: total * (r.ikeShare || 0),
    };
  });

  return (
    <div className="h-96 w-full">
      <ResponsiveContainer width="100%" height="100%">
        <AreaChart data={processedData}>
          <defs>
            <linearGradient id="colorPPK" x1="0" y1="0" x2="0" y2="1">
              <stop offset="5%" stopColor="#4f46e5" stopOpacity={0.8}/>
              <stop offset="95%" stopColor="#4f46e5" stopOpacity={0.1}/>
            </linearGradient>
            <linearGradient id="colorCrypto" x1="0" y1="0" x2="0" y2="1">
              <stop offset="5%" stopColor="#8b5cf6" stopOpacity={0.8}/>
              <stop offset="95%" stopColor="#8b5cf6" stopOpacity={0.1}/>
            </linearGradient>
            <linearGradient id="colorIKE" x1="0" y1="0" x2="0" y2="1">
              <stop offset="5%" stopColor="#06b6d4" stopOpacity={0.8}/>
              <stop offset="95%" stopColor="#06b6d4" stopOpacity={0.1}/>
            </linearGradient>
          </defs>
          <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#e2e8f0" />
          <XAxis 
            dataKey="date" 
            tickFormatter={formatDate} 
            stroke="#94a3b8" 
            fontSize={12}
            tickMargin={10}
          />
          <YAxis 
            tickFormatter={(val) => `${(val/1000).toFixed(0)}k`} 
            stroke="#94a3b8" 
            fontSize={12}
          />
          <Tooltip 
            formatter={(value: number, name: string) => {
               const labels: Record<string, string> = {
                 ppkValue: 'PPK',
                 cryptoValue: 'Krypto',
                 ikeValue: 'IKE'
               };
               return [`${value.toLocaleString('pl-PL')} zł`, labels[name] || name];
            }}
            labelFormatter={formatDate}
            contentStyle={{ backgroundColor: '#fff', borderRadius: '8px', border: '1px solid #e2e8f0' }}
          />
          <Legend verticalAlign="top" height={36} />
          <Area 
            type="monotone" 
            dataKey="ppkValue" 
            name="PPK" 
            stackId="1" 
            stroke="#4f46e5" 
            fill="url(#colorPPK)" 
          />
          <Area 
            type="monotone" 
            dataKey="cryptoValue" 
            name="Krypto" 
            stackId="1" 
            stroke="#8b5cf6" 
            fill="url(#colorCrypto)" 
          />
          <Area 
            type="monotone" 
            dataKey="ikeValue" 
            name="IKE" 
            stackId="1" 
            stroke="#06b6d4" 
            fill="url(#colorIKE)" 
          />
        </AreaChart>
      </ResponsiveContainer>
    </div>
  );
};

export const GlobalPerformanceChart: React.FC<ChartProps> = ({ data }) => {
  // Filter out initial zero values to avoid messy lines at start
  const chartData = data.filter((d, i) => i > 0 || (d.roi !== 0 && d.roi !== undefined));

  return (
    <div className="h-80 w-full">
      <ResponsiveContainer width="100%" height="100%">
        <ComposedChart data={chartData as any[]}>
          <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#e2e8f0" />
          <XAxis 
            dataKey="date" 
            tickFormatter={formatDate} 
            stroke="#94a3b8" 
            fontSize={12}
            tickMargin={10}
          />
          <YAxis 
            stroke="#94a3b8" 
            fontSize={12} 
            unit="%" 
          />
          <Tooltip 
            formatter={(value: number, name: string) => {
               const labels: Record<string, string> = {
                 roi: 'ROI (Skumulowane)',
                 cumulativeTwr: 'TWR (Portfel bez PPK)'
               };
               return [`${value.toFixed(2)}%`, labels[name] || name];
            }}
            labelFormatter={formatDate}
            contentStyle={{ backgroundColor: '#fff', borderRadius: '8px', border: '1px solid #e2e8f0' }}
          />
          <Legend verticalAlign="top" height={36} />
          <ReferenceLine y={0} stroke="#64748b" strokeDasharray="3 3" />
          
          {/* Total ROI Line */}
          <Line 
            type="monotone" 
            dataKey="roi" 
            name="ROI (Całość)" 
            stroke="#10b981" 
            strokeWidth={2} 
            dot={false} 
          />
          
          {/* TWR Line (for active portfolio parts) */}
          <Line 
            type="monotone" 
            dataKey="cumulativeTwr" 
            name="TWR (Inwestycje)" 
            stroke="#f59e0b" 
            strokeWidth={2} 
            strokeDasharray="5 5"
            dot={false} 
          />
        </ComposedChart>
      </ResponsiveContainer>
    </div>
  );
};

export const PortfolioAllocationHistoryChart: React.FC<ChartProps> = ({ data }) => {
  // Ensure data has shares
  const chartData = data.map(row => {
    const r = row as any;
    return {
      date: r.date,
      ppk: (r.ppkShare || 0) * 100,
      crypto: (r.cryptoShare || 0) * 100,
      ike: (r.ikeShare || 0) * 100,
    };
  });

  return (
    <div className="h-80 w-full">
      <ResponsiveContainer width="100%" height="100%">
        <AreaChart data={chartData} stackOffset="expand">
          <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#e2e8f0" />
          <XAxis 
            dataKey="date" 
            tickFormatter={formatDate} 
            stroke="#94a3b8" 
            fontSize={12}
            tickMargin={10}
          />
          <YAxis 
            stroke="#94a3b8" 
            fontSize={12} 
            tickFormatter={(val) => `${(val * 100).toFixed(0)}%`}
          />
          <Tooltip 
            formatter={(value: number) => [`${(value * 100).toFixed(1)}%`]} // Corrected to match stackOffset="expand" output which is 0-1 ratio
            labelFormatter={formatDate}
            contentStyle={{ backgroundColor: '#fff', borderRadius: '8px', border: '1px solid #e2e8f0' }}
          />
          <Legend verticalAlign="top" height={36} />
          <Area type="monotone" dataKey="ppk" name="PPK" stackId="1" stroke="#4f46e5" fill="#4f46e5" fillOpacity={0.8} />
          <Area type="monotone" dataKey="crypto" name="Krypto" stackId="1" stroke="#8b5cf6" fill="#8b5cf6" fillOpacity={0.8} />
          <Area type="monotone" dataKey="ike" name="IKE" stackId="1" stroke="#06b6d4" fill="#06b6d4" fillOpacity={0.8} />
        </AreaChart>
      </ResponsiveContainer>
    </div>
  );
};

export const CapitalStructureHistoryChart: React.FC<ChartProps> = ({ data }) => {
  // Specifically for PPK: Employee, Employer, State, Profit
  // Check if PPK data
  if (data.length === 0 || !('employeeContribution' in data[0])) return null;

  const chartData = data.map(row => {
    const r = row as PPKDataRow;
    // profit can be negative, but for stacked area chart negative values can be tricky.
    // However, 'stackOffset="expand"' handles ratios.
    // If profit is negative, it might look weird in a stack. 
    // Let's assume we want to show absolute capital sources vs current value?
    // Actually, 'Capital Structure' usually implies where the money came from.
    // Profit is the remaining part.
    
    return {
      date: r.date,
      employee: r.employeeContribution,
      employer: r.employerContribution,
      state: r.stateContribution,
      profit: r.profit, // This could be negative
      total: r.totalValue
    };
  });

  return (
    <div className="h-80 w-full">
      <ResponsiveContainer width="100%" height="100%">
        <AreaChart data={chartData} stackOffset="expand">
          <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#e2e8f0" />
          <XAxis 
            dataKey="date" 
            tickFormatter={formatDate} 
            stroke="#94a3b8" 
            fontSize={12}
            tickMargin={10}
          />
          <YAxis 
            stroke="#94a3b8" 
            fontSize={12} 
            tickFormatter={(val) => `${(val * 100).toFixed(0)}%`}
          />
          <Tooltip 
            // Custom formatter to calculate percentage based on raw values
            formatter={(value: number, name: string, item: any) => {
               const payload = item.payload;
               // Re-calculate total because 'value' here is the raw number
               // but we want to display the % relative to the stack for that point
               // Since we don't have easy access to the calculated stack percent in formatter for expand,
               // we calculate manually.
               
               // Note: stackOffset="expand" normalizes data.
               // The value passed here is the RAW value (e.g. 1000 PLN).
               // To get %, we divide by total.
               const total = payload.employee + payload.employer + payload.state + payload.profit;
               const percent = total !== 0 ? (value / total) * 100 : 0;
               
               return [
                 `${percent.toFixed(1)}% (${value.toLocaleString('pl-PL')} zł)`, 
                 name
               ];
            }}
            labelFormatter={formatDate}
            contentStyle={{ backgroundColor: '#fff', borderRadius: '8px', border: '1px solid #e2e8f0' }}
          />
          <Legend verticalAlign="top" height={36} />
          <Area type="monotone" dataKey="employee" name="Wkład Własny" stackId="1" stroke="#3b82f6" fill="#3b82f6" fillOpacity={0.9} />
          <Area type="monotone" dataKey="employer" name="Pracodawca" stackId="1" stroke="#8b5cf6" fill="#8b5cf6" fillOpacity={0.9} />
          <Area type="monotone" dataKey="state" name="Państwo" stackId="1" stroke="#ec4899" fill="#ec4899" fillOpacity={0.9} />
          <Area type="monotone" dataKey="profit" name="Zysk/Strata" stackId="1" stroke="#10b981" fill="#10b981" fillOpacity={0.9} />
        </AreaChart>
      </ResponsiveContainer>
    </div>
  );
};